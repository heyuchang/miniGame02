{"version":3,"sources":["assets\\Script\\game.js"],"names":["AC","require","cc","Class","Component","properties","_status","blockPrefab","Prefab","blockSprite","SpriteFrame","warningSpriteFrame","propSpriteFrame","checkMgr","revivePage","Node","start","bindNode","generatePool","loadRes","init","c","_controller","_score","scoreMgr","rowNum","config","json","gap","animationSpeed","blockWidth","reviveTimer","blocksContainer","node","getChildByName","gameStart","recoveryAllBlocks","then","mapSet","result","num","map","Array","self","a","Math","floor","random","b","d","Promise","resolve","reject","i","j","itemType","instantiateBlock","x","y","width","startTime","startAnimationTime","setTimeout","elementCheck","checkNeedFall","checkNeedFallTimer","clearTimeout","onFall","checkGenerateProp","chain","canFall","getComponent","blockPool","put","playFallAction","k","gameOver","pageManager","addPage","social","active","closeBannerAdv","askRevive","rangeSprite","Sprite","fillRange","isRangeAction","numLabel","Label","string","clearInterval","setInterval","onSkipRevive","onReviveButton","showReviveSuccess","onReviveCertainBtn","removePage","onRevive","update","pages","onGameOver","restart","onOpenPage","onUserTouched","iid","jid","color","warning","pos","target","generatePropItem","type","onItem","tipBox","addMult","musicManager","onDouble","distance","sqrt","pow","surfaceAction","runAction","shackAction","onShakePhone","isPropChain","onBoom","onTouched","rockAction","onStep","onMagic","isSingle","console","log","NodePool","block","instantiate","data","parent","size","get","scale","children","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\n * @author heyuchang\n * @file 游戏控制\n */\nvar AC = require('GameAct')\ncc.Class({\n  extends: cc.Component,\n  properties: {\n    _status: 0, //0 未开始 1 游戏开始 2 游戏暂停 3 游戏结束 4 下落状态 5无法触摸状态\n    blockPrefab: cc.Prefab,\n    blockSprite: [cc.SpriteFrame], //todo: 换成动态生成 暂不处理\n    warningSpriteFrame: [cc.SpriteFrame],\n    propSpriteFrame: [cc.SpriteFrame],\n    checkMgr: require(\"elementCheck\"),\n    revivePage: cc.Node,\n  },\n  start() {\n    this.bindNode()\n    this.generatePool()\n    this.loadRes()\n  },\n  loadRes() {\n\n  },\n  init(c) {\n    this._controller = c\n    this._score = c.scoreMgr\n    this.rowNum = c.config.json.rowNum\n    this.gap = c.config.json.gap\n    this.animationSpeed = c.config.json.gap\n    this.blockWidth = (730 - (this.rowNum + 1) * this.gap) / this.rowNum\n    this.reviveTimer = null\n    //console.log(this.gap)\n    //console.log(this.blockWidth)\n  },\n  // 动态获取需要动态控制的组件\n  bindNode() {\n    this.blocksContainer = this.node.getChildByName('map')\n  },\n  //---------------- 游戏控制 ---------------------\n  // 游戏开始\n  gameStart() {\n    this.recoveryAllBlocks().then()\n    this._score.init(this)\n    this.mapSet(this.rowNum).then((result) => {\n      // console.log('游戏状态改变', result)\n      this._status = 1\n    })\n\n  },\n  // 初始化地图\n  mapSet(num) {\n    this.map = new Array()\n    let self = this\n    // 生成两个随机的对象数组\n    let a = Math.floor(Math.random() * num)\n    let b = Math.floor(Math.random() * num)\n\n    let c = Math.floor(1 + Math.random() * (num - 1)) - 1\n    a == c ? c++ : ''\n    let d = Math.floor(Math.random() * num)\n\n\n    return new Promise((resolve, reject) => {\n      for (let i = 0; i < num; i++) { //行\n        this.map[i] = new Array()\n        for (let j = 0; j < num; j++) { //列\n          let itemType = (i == a && j == b) ? 1 : (i == c && j == d) ? 2 : 0\n          self.map[i][j] = self.instantiateBlock(self, {\n            x: j,\n            y: i,\n            width: self.blockWidth,\n            startTime: (i + j + 1) * self._controller.config.json.startAnimationTime / num * 2\n          }, self.blocksContainer, itemType)\n        }\n      }\n      this.checkMgr.init(this)\n      setTimeout(() => {\n          resolve('200 OK');\n          this.checkMgr.elementCheck(this)\n        }, self._controller.config.json.startAnimationTime * num / 2 / 1\n        //  (cc.game.getFrameRate() / 60)\n      )\n    })\n  },\n  //防抖动 判断是否需要检测下落\n  checkNeedFall() {\n    if (this.checkNeedFallTimer) {\n      clearTimeout(this.checkNeedFallTimer)\n    }\n    this.checkNeedFallTimer = setTimeout(() => {\n        if (this._status == 5) {\n          this._status = 4\n          this.onFall()\n        }\n      }, 300 / 1\n      // (cc.game.getFrameRate() / 60)\n    )\n  },\n  //方块下落\n  onFall() {\n    this.checkGenerateProp(this._score.chain).then(() => {\n      let self = this\n      let canFall = 0\n      //从每一列的最下面一个开始往上判断\n      //如果有空 就判断有几个空 然后让最上方的方块掉落下来\n      for (let j = this.rowNum - 1; j >= 0; j--) {\n        canFall = 0\n        for (let i = this.rowNum - 1; i >= 0; i--) {\n          if (this.map[i][j].getComponent('element')._status == 2) {\n            this.blockPool.put(this.map[i][j])\n            this.map[i][j] = null\n            canFall++\n          } else {\n            if (canFall != 0) {\n              this.map[i + canFall][j] = this.map[i][j]\n              this.map[i][j] = null\n              this.map[i + canFall][j].getComponent('element').playFallAction(canFall, {\n                x: j,\n                y: i + canFall,\n              })\n            }\n          }\n        }\n        for (var k = 0; k < canFall; k++) {\n          this.map[k][j] = this.instantiateBlock(this, {\n            x: j,\n            y: k,\n            width: this.blockWidth,\n            startTime: null\n          }, this.blocksContainer, '', {\n            x: j,\n            y: -canFall + k\n          })\n          this.map[k][j].getComponent('element').playFallAction(canFall, null)\n        }\n      }\n      setTimeout(() => {\n        this.checkMgr.init(this)\n        this.checkMgr.elementCheck(this)\n        this._status = 1\n      }, 250)\n    })\n  },\n  gameOver() {\n    this._status = 3\n    this._controller.pageManager.addPage(2)\n    this._controller.pageManager.addPage(4)\n    if (this._controller.social.node.active) {\n      this._controller.social.closeBannerAdv()\n    }\n  },\n  // todo 复活\n  askRevive() {\n    this._controller.pageManager.addPage(2)\n    this._controller.pageManager.addPage(5)\n    this.revivePage.active = true\n    this.revivePage.getChildByName('askRevive').active = true\n    this.revivePage.getChildByName('successRevive').active = false\n    this.rangeSprite = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('sprite').getComponent(cc.Sprite)\n    this.rangeSprite.fillRange = 1\n    this.isRangeAction = true\n    let numLabel = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('num').getComponent(cc.Label)\n    numLabel.string = 9\n    if (this.reviveTimer) {\n      clearInterval(this.reviveTimer)\n    }\n    this.reviveTimer = setInterval(() => {\n      if (+numLabel.string > 0) {\n        numLabel.string--\n        this.rangeSprite.fillRange = 1\n      } else {\n        this.onSkipRevive()\n      }\n    }, 1000)\n\n  },\n  onReviveButton() {\n    clearInterval(this.reviveTimer)\n    this.isRangeAction = false\n    if (this._controller.social.node.active) {\n      this._controller.social.onReviveButton(1)\n    } else {\n      this.showReviveSuccess()\n    }\n  },\n  showReviveSuccess() {\n    //console.log('打开复活成功页面')\n    this.revivePage.getChildByName('askRevive').active = false\n    this.revivePage.getChildByName('successRevive').active = true\n  },\n  onReviveCertainBtn() {\n    this._controller.pageManager.removePage(2)\n    this.revivePage.active = false\n    this._status = 1\n    this._score.onRevive()\n  },\n  update() {\n    if (this.isRangeAction) {\n      this.rangeSprite.fillRange -= 1 / 60\n    }\n  },\n  onSkipRevive() {\n    clearInterval(this.reviveTimer)\n    this._controller.pageManager.pages[5].active = false\n    this._score.onGameOver(true)\n    this.isRangeAction = false\n  },\n  restart() {\n    this._controller.pageManager.onOpenPage(1)\n    this.recoveryAllBlocks().then(() => {\n      this.gameStart()\n    })\n  },\n  // -----------------道具相关---------------\n  // 储存用户点击时的方块 用于生成道具\n  onUserTouched(iid, jid, itemType, color, warning, pos) {\n    this.target = {\n      i: iid,\n      j: jid,\n      color: color,\n      itemType: itemType,\n      x: pos.x,\n      y: pos.y,\n      warning: warning\n    }\n  },\n  // 生成道具 type 1为双倍倍数 2为炸弹 3为加五百\n  generatePropItem(type) {\n    return new Promise((resolve, reject) => {\n      // 是否做道具生成动画\n      this.map[this.target.i][this.target.j] = this.instantiateBlock(this, {\n        x: this.target.j,\n        y: this.target.i,\n        color: this.target.color,\n        width: this.blockWidth,\n        startTime: null\n      }, this.blocksContainer, type)\n      setTimeout(() => {\n        resolve()\n      }, 300)\n    })\n  },\n  checkGenerateProp(chain) {\n    return new Promise((resolve, reject) => {\n      if (this.target.warning) {\n        this.generatePropItem(this.target.warning).then(() => {\n          resolve()\n          return\n        })\n      }\n      resolve()\n    })\n  },\n  onItem(type, color, pos) {\n    switch (type) {\n      case 1:\n        // 分数翻倍 最高八倍\n        this._score.tipBox.init(this._score, 1)\n        this._score.addMult(color, pos)\n        this._controller.musicManager.onDouble()\n        for (let i = 0; i < this.rowNum; i++) { //行\n          for (let j = 0; j < this.rowNum; j++) { //列\n            if (this.map[i][j] && this.map[i][j].getComponent('element')._status == 1) {\n              let distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n              if (distance != 0) {\n                this.map[i][j].getComponent('element').surfaceAction(distance)\n              }\n\n            }\n          }\n        }\n        break\n      case 2:\n        // 炸弹 消除同种颜色的\n        this._score.tipBox.init(this._score, 2)\n        this.node.runAction(AC.shackAction(0.1, 10))\n        if (this._controller.social.node.active) {\n          this._controller.social.onShakePhone()\n        }\n        this.isPropChain = true\n        this._controller.musicManager.onBoom()\n        for (let i = 0; i < this.rowNum; i++) { //行\n          for (let j = 0; j < this.rowNum; j++) { //列\n            if (this.map[i][j] && this.map[i][j].getComponent('element').color == color && this.map[i][j] && this.map[i][j].getComponent('element')._status != 2) {\n              this.map[i][j].getComponent('element').onTouched(color, false, true)\n            }\n            else {\n              this.map[i][j].runAction(AC.rockAction(0.2, 10))\n            }\n          }\n        }\n        break\n      case 3: //:  加步数\n        this._score.tipBox.init(this._score, 4)\n        this._controller.musicManager.onDouble()\n        for (let i = 0; i < this.rowNum; i++) { //行\n          for (let j = 0; j < this.rowNum; j++) { //列\n            if (this.map[i][j] && this.map[i][j].getComponent('element')._status == 1) {\n              let distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n              if (distance != 0) {\n                this.map[i][j].getComponent('element').surfaceAction(distance)\n              }\n            }\n          }\n        }\n        this._score.onStep(3).then()\n        break;\n      case 4: // : 消除全部单身的方块\n        this._score.tipBox.init(this._score, 5)\n        this.isPropChain = true\n        this._controller.musicManager.onMagic()\n        for (let i = 0; i < this.rowNum; i++) { //行\n          for (let j = 0; j < this.rowNum; j++) { //列\n            if (this.map[i][j] && this.map[i][j].getComponent('element').isSingle && this.map[i][j] && this.map[i][j].getComponent('element')._status != 2) {\n              let distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n              this.map[i][j].getComponent('element').onTouched(color, false, true, distance)\n              console.log(\"魔法棒触发的点\", i,j,this.map[i][j].getComponent('element').color, this.map[i][j].getComponent('element').isSingle)\n            }\n          }\n        }\n        break;\n    }\n  },\n  //--------------------- 预制体实例化---------------------\n  // 生成对象池\n  generatePool() {\n    this.blockPool = new cc.NodePool()\n    for (let i = 0; i < Math.pow(this.rowNum, 2); i++) {\n      let block = cc.instantiate(this.blockPrefab)\n      this.blockPool.put(block)\n    }\n  },\n  // 实例化单个方块\n  instantiateBlock(self, data, parent, itemType, pos) {\n    itemType = itemType ? itemType : 0\n    if (itemType != 0) {\n      // console.log(\"道具节点数据\", data, itemType)\n    }\n    let block = null\n    if (self.blockPool && self.blockPool.size() > 0) {\n      block = self.blockPool.get()\n    } else {\n      block = cc.instantiate(self.blockPrefab)\n    }\n    block.parent = parent\n    block.scale = 1\n    block.x = 0\n    block.y = 0\n    block.getComponent('element').init(self, data, this.blockWidth, itemType, pos)\n    return block\n  },\n  // 回收所有节点\n  recoveryAllBlocks() {\n    return new Promise((resolve, reject) => {\n      let children = this.blocksContainer.children\n      if (children.length != 0) {\n        let length = children.length\n        //   console.log(length)\n        for (let i = 0; i < length; i++) {\n          this.blockPool.put(children[0])\n        }\n        for (let i = 0; i < this.rowNum; i++) {\n          for (let j = 0; j < this.rowNum; j++) {\n            this.map[i][j] = null\n          }\n        }\n      }\n      resolve('')\n    })\n  },\n\n});"]}