{"version":3,"sources":["assets\\Script\\game.js"],"names":["AC","require","cc","Class","Component","properties","statusType","blockPrefab","Prefab","blockSprite","SpriteFrame","warningSpriteFrame","propSpriteFrame","checkMgr","revivePage","Node","start","bindNode","generatePrefabPool","loadRes","init","c","_gameController","_gameScore","scoreMgr","rowCfgNum","config","json","gapCfgNum","animaCfgSpeed","blockClsWidth","reviveTimer","blocksContainer","node","getChildByName","gameStart","recoveryAllBlocks","then","gameMapInit","result","num","map","self","a","b","d","Math","floor","random","Promise","resolve","reject","i","j","itemType","instantiateBlock","x","y","width","startTime","startAnimationTime","setTimeout","elementCheck","checkNeedFall","checkNeedFallTimer","clearTimeout","onFall","checkGenerateProp","chain","canFall","getComponent","blockPool","put","playFallAction","k","gameOver","pageManager","addPage","social","active","closeBannerAdv","askRevive","rangeSprite","Sprite","fillRange","isRangeAction","numLabel","Label","string","clearInterval","setInterval","onSkipRevive","onReviveButton","showReviveSuccess","onReviveCertainBtn","removePage","onRevive","update","pages","onGameOver","restart","onOpenPage","onUserTouched","iid","jid","color","warning","pos","target","generatePropItem","type","onItem","tipBox","addMult","musicManager","onDouble","distance","sqrt","pow","surfaceAction","runAction","shackAction","onShakePhone","isPropChain","onBoom","onTouched","rockAction","onStep","onMagic","isSingle","console","log","NodePool","block","instantiate","data","parent","size","get","scale","children","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * @author heyuchang\r\n * @file 游戏控制\r\n */\r\nvar AC = require('GameAct')\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    statusType: 0, //0 未开始 1 游戏开始 2 游戏暂停 3 游戏结束 4 下落状态 5无法触摸状态\r\n    blockPrefab: cc.Prefab,\r\n    blockSprite: [cc.SpriteFrame], //todo: 换成动态生成 暂不处理\r\n    warningSpriteFrame: [cc.SpriteFrame],\r\n    propSpriteFrame: [cc.SpriteFrame],\r\n    checkMgr: require(\"elementCheck\"),\r\n    revivePage: cc.Node,\r\n  },\r\n  start() {\r\n    this.bindNode()\r\n    this.generatePrefabPool()\r\n    this.loadRes()\r\n  },\r\n  loadRes() {\r\n\r\n  },\r\n  init(c) {\r\n    this._gameController = c\r\n    this._gameScore = c.scoreMgr\r\n    this.rowCfgNum = c.config.json.rowCfgNum\r\n    this.gapCfgNum = c.config.json.gapCfgNum\r\n    this.animaCfgSpeed = c.config.json.gapCfgNum\r\n    this.blockClsWidth = (730 - (this.rowCfgNum + 1) * this.gapCfgNum) / this.rowCfgNum\r\n    this.reviveTimer = null\r\n  },\r\n  // 动态获取需要动态控制的组件\r\n  bindNode() {\r\n    this.blocksContainer = this.node.getChildByName('map')\r\n  },\r\n  //---------------- 游戏控制 ---------------------\r\n  // 游戏开始\r\n  gameStart() {\r\n    this.recoveryAllBlocks().then()\r\n    this._gameScore.init(this)\r\n    this.gameMapInit(this.rowCfgNum).then((result) => {\r\n      this.statusType = 1\r\n    })\r\n\r\n  },\r\n  // 初始化地图\r\n  gameMapInit(num) {\r\n    this.map = [];\r\n    const self = this;\r\n\r\n    // 生成两个随机的对象数组\r\n    let a, b, c, d;\r\n    do {\r\n      a = Math.floor(Math.random() * num);\r\n      b = Math.floor(Math.random() * num);\r\n      c = Math.floor(1 + Math.random() * (num - 1)) - 1;\r\n      d = Math.floor(Math.random() * num);\r\n    } while (a === c && b === d);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      for (let i = 0; i < num; i++) {\r\n        this.map[i] = [];\r\n        for (let j = 0; j < num; j++) {\r\n          let itemType = (i === a && j === b) ? 1 : (i === c && j === d) ? 2 : 0;\r\n          self.map[i][j] = self.instantiateBlock(self, {\r\n            x: j,\r\n            y: i,\r\n            width: self.blockClsWidth,\r\n            startTime: (i + j + 1) * self._gameController.config.json.startAnimationTime / num * 2\r\n          }, self.blocksContainer, itemType);\r\n        }\r\n      }\r\n      this.checkMgr.init(self);\r\n      setTimeout(() => {\r\n        resolve('200 OK');\r\n        this.checkMgr.elementCheck(self);\r\n      }, self._gameController.config.json.startAnimationTime * num / 2 / 1);\r\n    });\r\n  },\r\n\r\n  //防抖动 判断是否需要检测下落\r\n  checkNeedFall() {\r\n    if (this.checkNeedFallTimer) {\r\n      clearTimeout(this.checkNeedFallTimer)\r\n    }\r\n    this.checkNeedFallTimer = setTimeout(() => {\r\n      if (this.statusType == 5) {\r\n        this.statusType = 4\r\n        this.onFall()\r\n      }\r\n    }, 300 / 1\r\n      // (cc.game.getFrameRate() / 60)\r\n    )\r\n  },\r\n  onFall() {\r\n    // 调用 checkGenerateProp 方法并返回 Promise，然后在 Promise 成功时执行后续操作\r\n    return this.checkGenerateProp(this._gameScore.chain).then(() => {\r\n      // 用于记录每列可下落的方块数量\r\n      let canFall;\r\n      // 从每一列的最下面开始往上遍历\r\n      for (let j = this.rowCfgNum - 1; j >= 0; j--) {\r\n        canFall = 0;\r\n        // 从每一列的底部往上遍历每一行\r\n        for (let i = this.rowCfgNum - 1; i >= 0; i--) {\r\n          // 如果当前方块状态类型为 2\r\n          if (this.map[i][j].getComponent('element').statusType === 2) {\r\n            // 将当前方块放入方块池中\r\n            this.blockPool.put(this.map[i][j]);\r\n            // 将当前位置的方块设置为 null\r\n            this.map[i][j] = null;\r\n            // 增加可下落的方块数量\r\n            canFall++;\r\n          } else if (canFall !== 0) {\r\n            // 如果有可下落的方块且当前方块不是状态类型为 2 的方块\r\n            // 将当前方块移动到下方的空位\r\n            this.map[i + canFall][j] = this.map[i][j];\r\n            // 将当前位置的方块设置为 null\r\n            this.map[i][j] = null;\r\n            // 让当前方块执行下落动作，传入下落的距离和新位置\r\n            this.map[i + canFall][j].getComponent('element').playFallAction(canFall, {\r\n              x: j,\r\n              y: i + canFall,\r\n            });\r\n          }\r\n        }\r\n        // 对于每一列中可下落的空位，生成新的方块并执行下落动作\r\n        for (let k = 0; k < canFall; k++) {\r\n          this.map[k][j] = this.instantiateBlock(this, {\r\n            x: j,\r\n            y: k,\r\n            width: this.blockClsWidth,\r\n            startTime: null\r\n          }, this.blocksContainer, '', {\r\n            x: j,\r\n            y: -canFall + k\r\n          });\r\n          this.map[k][j].getComponent('element').playFallAction(canFall, null);\r\n        }\r\n      }\r\n      // 设置超时，超时后执行检查和元素检查，并设置状态类型\r\n      setTimeout(() => {\r\n        this.checkMgr.init(this);\r\n        this.checkMgr.elementCheck(this);\r\n        this.statusType = 1;\r\n      }, 250);\r\n    });\r\n  },\r\n  gameOver() {\r\n    this.statusType = 3\r\n    this._gameController.pageManager.addPage(2)\r\n    this._gameController.pageManager.addPage(4)\r\n    if (this._gameController.social.node.active) {\r\n      this._gameController.social.closeBannerAdv()\r\n    }\r\n  },\r\n  // todo 复活\r\n  askRevive() {\r\n    this._gameController.pageManager.addPage(2)\r\n    this._gameController.pageManager.addPage(5)\r\n    this.revivePage.active = true\r\n    this.revivePage.getChildByName('askRevive').active = true\r\n    this.revivePage.getChildByName('successRevive').active = false\r\n    this.rangeSprite = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('sprite').getComponent(cc.Sprite)\r\n    this.rangeSprite.fillRange = 1\r\n    this.isRangeAction = true\r\n    let numLabel = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('num').getComponent(cc.Label)\r\n    numLabel.string = 9\r\n    if (this.reviveTimer) {\r\n      clearInterval(this.reviveTimer)\r\n    }\r\n    this.reviveTimer = setInterval(() => {\r\n      if (+numLabel.string > 0) {\r\n        numLabel.string--\r\n        this.rangeSprite.fillRange = 1\r\n      } else {\r\n        this.onSkipRevive()\r\n      }\r\n    }, 1000)\r\n\r\n  },\r\n  onReviveButton() {\r\n    clearInterval(this.reviveTimer)\r\n    this.isRangeAction = false\r\n    if (this._gameController.social.node.active) {\r\n      this._gameController.social.onReviveButton(1)\r\n    } else {\r\n      this.showReviveSuccess()\r\n    }\r\n  },\r\n  showReviveSuccess() {\r\n    //console.log('打开复活成功页面')\r\n    this.revivePage.getChildByName('askRevive').active = false\r\n    this.revivePage.getChildByName('successRevive').active = true\r\n  },\r\n  onReviveCertainBtn() {\r\n    this._gameController.pageManager.removePage(2)\r\n    this.revivePage.active = false\r\n    this.statusType = 1\r\n    this._gameScore.onRevive()\r\n  },\r\n  update() {\r\n    if (this.isRangeAction) {\r\n      this.rangeSprite.fillRange -= 1 / 60\r\n    }\r\n  },\r\n  onSkipRevive() {\r\n    clearInterval(this.reviveTimer)\r\n    this._gameController.pageManager.pages[5].active = false\r\n    this._gameScore.onGameOver(true)\r\n    this.isRangeAction = false\r\n  },\r\n  restart() {\r\n    this._gameController.pageManager.onOpenPage(1)\r\n    this.recoveryAllBlocks().then(() => {\r\n      this.gameStart()\r\n    })\r\n  },\r\n  // -----------------道具相关---------------\r\n  // 储存用户点击时的方块 用于生成道具\r\n  onUserTouched(iid, jid, itemType, color, warning, pos) {\r\n    this.target = {\r\n      i: iid,\r\n      j: jid,\r\n      color: color,\r\n      itemType: itemType,\r\n      x: pos.x,\r\n      y: pos.y,\r\n      warning: warning\r\n    }\r\n  },\r\n  // 生成道具 type 1为双倍倍数 2为炸弹 3为加五百\r\n  generatePropItem(type) {\r\n    return new Promise((resolve, reject) => {\r\n      // 是否做道具生成动画\r\n      this.map[this.target.i][this.target.j] = this.instantiateBlock(this, {\r\n        x: this.target.j,\r\n        y: this.target.i,\r\n        color: this.target.color,\r\n        width: this.blockClsWidth,\r\n        startTime: null\r\n      }, this.blocksContainer, type)\r\n      setTimeout(() => {\r\n        resolve()\r\n      }, 300)\r\n    })\r\n  },\r\n  checkGenerateProp(chain) {\r\n    return new Promise((resolve, reject) => {\r\n      if (this.target.warning) {\r\n        this.generatePropItem(this.target.warning).then(() => {\r\n          resolve()\r\n          return\r\n        })\r\n      }\r\n      resolve()\r\n    })\r\n  },\r\n  onItem(type, color, pos) {\r\n    switch (type) {\r\n      case 1:\r\n        // 分数翻倍 最高八倍\r\n        this._gameScore.tipBox.init(this._gameScore, 1)\r\n        this._gameScore.addMult(color, pos)\r\n        this._gameController.musicManager.onDouble()\r\n        for (let i = 0; i < this.rowCfgNum; i++) { //行\r\n          for (let j = 0; j < this.rowCfgNum; j++) { //列\r\n            if (this.map[i][j] && this.map[i][j].getComponent('element').statusType == 1) {\r\n              let distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\r\n              if (distance != 0) {\r\n                this.map[i][j].getComponent('element').surfaceAction(distance)\r\n              }\r\n\r\n            }\r\n          }\r\n        }\r\n        break\r\n      case 2:\r\n        // 炸弹 消除同种颜色的\r\n        this._gameScore.tipBox.init(this._gameScore, 2)\r\n        this.node.runAction(AC.shackAction(0.1, 10))\r\n        if (this._gameController.social.node.active) {\r\n          this._gameController.social.onShakePhone()\r\n        }\r\n        this.isPropChain = true\r\n        this._gameController.musicManager.onBoom()\r\n        for (let i = 0; i < this.rowCfgNum; i++) { //行\r\n          for (let j = 0; j < this.rowCfgNum; j++) { //列\r\n            if (this.map[i][j] && this.map[i][j].getComponent('element').color == color && this.map[i][j] && this.map[i][j].getComponent('element').statusType != 2) {\r\n              this.map[i][j].getComponent('element').onTouched(color, false, true)\r\n            }\r\n            else {\r\n              this.map[i][j].runAction(AC.rockAction(0.2, 10))\r\n            }\r\n          }\r\n        }\r\n        break\r\n      case 3: //:  加步数\r\n        this._gameScore.tipBox.init(this._gameScore, 4)\r\n        this._gameController.musicManager.onDouble()\r\n        for (let i = 0; i < this.rowCfgNum; i++) { //行\r\n          for (let j = 0; j < this.rowCfgNum; j++) { //列\r\n            if (this.map[i][j] && this.map[i][j].getComponent('element').statusType == 1) {\r\n              let distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\r\n              if (distance != 0) {\r\n                this.map[i][j].getComponent('element').surfaceAction(distance)\r\n              }\r\n            }\r\n          }\r\n        }\r\n        this._gameScore.onStep(3).then()\r\n        break;\r\n      case 4: // : 消除全部单身的方块\r\n        this._gameScore.tipBox.init(this._gameScore, 5)\r\n        this.isPropChain = true\r\n        this._gameController.musicManager.onMagic()\r\n        for (let i = 0; i < this.rowCfgNum; i++) { //行\r\n          for (let j = 0; j < this.rowCfgNum; j++) { //列\r\n            if (this.map[i][j] && this.map[i][j].getComponent('element').isSingle && this.map[i][j] && this.map[i][j].getComponent('element').statusType != 2) {\r\n              let distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\r\n              this.map[i][j].getComponent('element').onTouched(color, false, true, distance)\r\n              console.log(\"魔法棒触发的点\", i, j, this.map[i][j].getComponent('element').color, this.map[i][j].getComponent('element').isSingle)\r\n            }\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  },\r\n  //--------------------- 预制体实例化---------------------\r\n  // 生成对象池\r\n  generatePrefabPool() {\r\n    this.blockPool = new cc.NodePool()\r\n    for (let i = 0; i < Math.pow(this.rowCfgNum, 2); i++) {\r\n      let block = cc.instantiate(this.blockPrefab)\r\n      this.blockPool.put(block)\r\n    }\r\n  },\r\n  // 实例化单个方块\r\n  instantiateBlock(self, data, parent, itemType, pos) {\r\n    itemType = itemType ? itemType : 0\r\n    if (itemType != 0) {\r\n      // console.log(\"道具节点数据\", data, itemType)\r\n    }\r\n    let block = null\r\n    if (self.blockPool && self.blockPool.size() > 0) {\r\n      block = self.blockPool.get()\r\n    } else {\r\n      block = cc.instantiate(self.blockPrefab)\r\n    }\r\n    block.parent = parent\r\n    block.scale = 1\r\n    block.x = 0\r\n    block.y = 0\r\n    block.getComponent('element').init(self, data, this.blockClsWidth, itemType, pos)\r\n    return block\r\n  },\r\n  // 回收所有节点\r\n  recoveryAllBlocks() {\r\n    return new Promise((resolve, reject) => {\r\n      let children = this.blocksContainer.children\r\n      if (children.length != 0) {\r\n        let length = children.length\r\n        //   console.log(length)\r\n        for (let i = 0; i < length; i++) {\r\n          this.blockPool.put(children[0])\r\n        }\r\n        for (let i = 0; i < this.rowCfgNum; i++) {\r\n          for (let j = 0; j < this.rowCfgNum; j++) {\r\n            this.map[i][j] = null\r\n          }\r\n        }\r\n      }\r\n      resolve('')\r\n    })\r\n  },\r\n\r\n});"]}