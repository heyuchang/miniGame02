{"version":3,"sources":["assets\\Script\\character.js"],"names":["cc","Class","Component","properties","levelUp1","Node","levelUp2","character","fail","start","assetManager","loadBundle","err","bundle","self","onWalk","target","playAnimation","onLevelUp","onSuccessDialog","level","showCharacter","onLevelUpBtn","showHeroCharacter","onFail","initStartPage","color","loadRes","loadHeroPrefab","prefabPath","heroPrefab","destroy","load","Prefab","prefab","console","error","heroPrefabPath","instantiate","node","addChild","setParent","setPosition","Color","WHITE","loadAvatarPrefab","loadPrefab","instPrefab","showAvatarCharacter","heroAvatarPrefab","heroAvatarPrefabPath"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n  extends: cc.Component,\n\n  properties: {\n    levelUp1: cc.Node,\n    levelUp2: cc.Node,\n    character: cc.Node,\n    fail: cc.Node,\n  },\n  start() {\n    cc.assetManager.loadBundle('game', (err, bundle) => {\n      self.bundle = bundle;\n    });\n  },\n\n\n\n  onWalk(target) {\n    target.playAnimation('walk', -1)\n  },\n  onLevelUp() {\n    //this.levelUp2.getComponent(dragonBones.ArmatureDisplay).playAnimation('jump', -1)\n  },\n  onSuccessDialog(level) {\n    this.showCharacter(level, this.levelUp2)\n\n  },\n  onLevelUpBtn(level) {\n    this.showHeroCharacter(level)\n  },\n  onFail(level) {\n    this.showCharacter(level, this.fail)\n  },\n\n  initStartPage() {\n\n  },\n\n  showHeroCharacter(level, target, color) {\n    target = target || this.character\n\n    let loadRes = 'heroPrefab/heroSpine' + level\n    this.loadHeroPrefab(loadRes, target, color);\n  },\n\n  loadHeroPrefab(prefabPath, target, color) {\n\n    if (self.heroPrefab) {\n      // cc.assetManager.releaseAsset(self.heroPrefab);\n      // cc.de(prefab);\n      self.heroPrefab.destroy();\n      self.heroPrefab = null;\n      // self.bundle.release(self.heroPrefabPath, cc.Prefab);\n    }\n\n    self.bundle.load(prefabPath, cc.Prefab, (err, prefab) => {\n      if (err) {\n        console.error('加载 Prefab 失败：', err);\n        return;\n      }\n\n      self.heroPrefabPath = prefabPath\n\n      // Prefab 加载成功后，使用 instantiate 方法创建实例\n      self.heroPrefab = cc.instantiate(prefab);\n      // 将实例添加到当前节点下\n      this.node.addChild(self.heroPrefab);\n      // 可以设置新节点的位置等属性\n\n      self.heroPrefab.setParent(target);\n      self.heroPrefab.setPosition(0, 0, 0);\n\n      if (color) {\n        self.heroPrefab.color = color\n      }\n      else {\n        self.heroPrefab.color = cc.Color.WHITE\n      }\n    });\n  },\n\n\n  showCharacter(level, target, color) {\n    target = target || this.character\n\n    let loadRes = 'heroPrefab/heroSpine' + level\n    this.loadAvatarPrefab(loadRes, target, color);\n  },\n\n  loadPrefab(prefabPath, target, color) {\n    self.bundle.load(prefabPath, cc.Prefab, (err, prefab) => {\n      if (err) {\n        console.error('加载 Prefab 失败：', err);\n        return;\n      }\n\n      // if (self.heroAvatarPrefab) {\n      //   cc.assetManager.releaseAsset(self.heroAvatarPrefab);\n      // }\n      // Prefab 加载成功后，使用 instantiate 方法创建实例\n      let instPrefab = cc.instantiate(prefab);\n      // 将实例添加到当前节点下\n      this.node.addChild(instPrefab);\n      // 可以设置新节点的位置等属性\n\n      instPrefab.setParent(target);\n      instPrefab.setPosition(0, 0, 0);\n\n      if (color) {\n        instPrefab.color = color\n      }\n      else {\n        instPrefab.color = cc.Color.WHITE\n      }\n    });\n  },\n\n\n  showAvatarCharacter(level, target, color) {\n    target = target || this.character\n\n    let loadRes = 'heroPrefab/heroSpine' + level\n    this.loadAvatarPrefab(loadRes, target, color);\n  },\n\n  loadAvatarPrefab(prefabPath, target, color) {\n    if (self.heroAvatarPrefab) {\n      // cc.assetManager.releaseAsset(self.heroAvatarPrefab);\n      self.heroAvatarPrefab.destroy();\n      self.heroAvatarPrefab = null;\n      // self.bundle.release(self.heroAvatarPrefabPath, cc.Prefab);\n    }\n\n    if (self.heroAvatarPrefabPath != prefabPath) {\n      self.bundle.load(prefabPath, cc.Prefab, (err, prefab) => {\n        if (err) {\n          console.error('加载 Prefab 失败：', err);\n          return;\n        }\n  \n        self.heroAvatarPrefabPath = prefabPath\n  \n        // Prefab 加载成功后，使用 instantiate 方法创建实例\n        self.heroAvatarPrefab = cc.instantiate(prefab);\n        // 将实例添加到当前节点下\n        this.node.addChild(self.heroAvatarPrefab);\n        // 可以设置新节点的位置等属性\n  \n        self.heroAvatarPrefab.setParent(target);\n        self.heroAvatarPrefab.setPosition(0, 0, 0);\n  \n        if (color) {\n          self.heroAvatarPrefab.color = color\n        }\n        else {\n          self.heroAvatarPrefab.color = cc.Color.WHITE\n        }\n      });\n    }\n  },\n});"]}