{"version":3,"sources":["assets\\Script\\element.js"],"names":["cc","Class","Component","properties","statusType","_itemType","warningSprite","Sprite","lightSprite","init","g","data","width","itemType","pos","_game","x","y","warningType","isPush","bindEvent","color","Math","ceil","random","colorSprite","node","getChildByName","getComponent","spriteFrame","propSpriteFrame","blockSprite","_width","_gameController","active","height","startTime","iid","jid","gapCfgNum","angle","playStartAction","onWarning","type","warningSpriteFrame","tween1","blink","warningInit","growInit","growType","grow","on","Node","EventType","TOUCH_START","onTouched","isChain","isBomb","time","setTimeout","JSON","stringify","self","playDieAction","then","onBlockPop","isSingle","scale","_gameScore","tipBox","scaleTo","action2","easing","easeBackOut","action","sequence","runAction","onUserTouched","onStep","res","checkNeedFall","musicManager","onPlayAudio","onItem","addScore","v2","config","json","propConfig","score","map","rowCfgNum","playFallAction","moveBy","blockClsWidth","easeBounceOut","seq","callFunc","scaleX","scaleY","animaCfgSpeed","clearTimeout","surfaceTimer","stopAllActions","Promise","resolve","reject","moveTo","target","action3","spawn","surfaceAction","dela","generatePropAction","generateItem"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * @author heyuchang\r\n * @file 单个方块控制\r\n */\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    statusType: 0, //1为可触发点击 2为已经消失\r\n    _itemType: 0, //新增道具功能 1为双倍倍数 2为炸弹\r\n    warningSprite: cc.Sprite,\r\n    lightSprite: cc.Sprite,\r\n  },\r\n  init(g, data, width, itemType, pos) {\r\n    this._game = g\r\n    this.statusType = 1\r\n    if (pos) {\r\n      //cc.log('生成的方块', pos)\r\n    }\r\n    pos = pos || {\r\n      x: data.x,\r\n      y: data.y\r\n    }\r\n    this._itemType = itemType || 0\r\n    this.warningType = 0\r\n    this.isPush = false\r\n    this.bindEvent()\r\n    this.color = data.color || Math.ceil(Math.random() * 4)\r\n    this.colorSprite = this.node.getChildByName('color').getComponent(cc.Sprite)\r\n    this.colorSprite.spriteFrame = itemType ? g.propSpriteFrame[(itemType - 1) * 4 + this.color - 1] : this._game.blockSprite[this.color - 1]\r\n    this.warningSprite.spriteFrame = ''\r\n    this._width = width\r\n    this._gameController = g._gameController\r\n    // 计算宽\r\n    this.lightSprite.node.active = false\r\n    //  this.lightSprite.spriteFrame = this._game.blockSprite[this.color - 1]\r\n    this.node.width = this.node.height = width\r\n    this.startTime = data.startTime\r\n    this.iid = data.y\r\n    this.jid = data.x\r\n    // console.log('生成方块位置', data.y, data.x)\r\n    this.node.x = -(730 / 2 - g.gapCfgNum - width / 2) + pos.x * (width + g.gapCfgNum)\r\n    this.node.y = (730 / 2 - g.gapCfgNum - width / 2) - pos.y * (width + g.gapCfgNum)\r\n    this.node.angle = 0\r\n    this.playStartAction()\r\n  },\r\n  onWarning(type) {\r\n    this.warningSprite.spriteFrame = this._game.warningSpriteFrame[type - 1] || ''\r\n    this.warningType = type\r\n    //   this.lightSprite.node.active = true\r\n    let tween1 = cc.blink(1, 10)\r\n    //   this.lightSprite.node.runAction(tween1)\r\n  },\r\n  warningInit() {\r\n    this.warningSprite.spriteFrame = ''\r\n    //  this.lightSprite.node.active = false\r\n    this.isPush = false\r\n  },\r\n  growInit() {\r\n    this.growType = 0\r\n    this.colorSprite.node.height = this.colorSprite.node.width = this._width\r\n    this.colorSprite.node.y = this.colorSprite.node.x = 0\r\n  },\r\n  grow(type) { //1234 上下左右\r\n    switch (type) {\r\n      case 1:\r\n        if (this.growType != 2) {\r\n          this.colorSprite.node.height += this._game.gapCfgNum * 2\r\n          this.colorSprite.node.y += this._game.gapCfgNum\r\n          this.growType = 1\r\n        }\r\n        break\r\n      case 2:\r\n        if (this.growType != 2) {\r\n          this.colorSprite.node.height += this._game.gapCfgNum * 2\r\n          this.colorSprite.node.y -= this._game.gapCfgNum\r\n          this.growType = 1\r\n        }\r\n        break\r\n      case 3:\r\n        if (this.growType != 1) {\r\n          this.colorSprite.node.width += this._game.gapCfgNum * 2\r\n          this.colorSprite.node.x -= this._game.gapCfgNum\r\n          this.growType = 2\r\n        }\r\n        break\r\n      case 4:\r\n        if (this.growType != 1) {\r\n          this.colorSprite.node.width += this._game.gapCfgNum * 2\r\n          this.colorSprite.node.x += this._game.gapCfgNum\r\n          this.growType = 2\r\n        }\r\n        break\r\n    }\r\n  },\r\n  bindEvent() {\r\n    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouched, this)\r\n  },\r\n  // 用户点击 或者被其他方块触发\r\n  onTouched(color, isChain, isBomb, time) { //道具新增参数 isChain是否连锁 isBomb是否强制消除\r\n    if (time) {\r\n      setTimeout(() => {\r\n        this.onTouched(color, false, isBomb)\r\n      }, time)\r\n      return\r\n    }\r\n    isChain = JSON.stringify(isChain) == 'null' ? true : isChain\r\n    isBomb = isBomb ? isBomb : false\r\n    let self = this\r\n    // 爆炸触发\r\n    if (this.statusType == 1 && isBomb == true) {\r\n      this.statusType = 2\r\n      this.playDieAction().then(() => {\r\n        this.onBlockPop(color, isChain, isBomb)\r\n      })\r\n      return\r\n    }\r\n\r\n    if (color.type) {\r\n      // 一定是用户主动触发 保存这个坐标给game\r\n      if (this.isSingle && this._itemType <= 1) {\r\n        this.node.scale = 1\r\n        this._game._gameScore.tipBox.init(this._game._gameScore, 3)\r\n        let tween1 = cc.scaleTo(0.1, 1.1, 0.9)\r\n        let action2 = cc.scaleTo(0.3, 1).easing(cc.easeBackOut(2.0))\r\n        let action = cc.sequence(tween1, action2)\r\n        this.node.runAction(action)\r\n        return\r\n      }\r\n      // console.log('方块位置', this.iid, this.jid, this._itemType)\r\n      color = this.color\r\n      if (this.statusType == 1 && this._game.statusType == 1 && this.color == color) {\r\n        this._game.onUserTouched(this.iid, this.jid, this._itemType, this.color, this.warningType, {\r\n          x: this.node.x,\r\n          y: this.node.y\r\n        })\r\n        this._game._gameScore.onStep(-1).then((res) => {\r\n          if (res) {\r\n            this.playDieAction().then(() => {\r\n              this.onBlockPop(color, null, null)\r\n            })\r\n          }\r\n        })\r\n      }\r\n    } else {\r\n      // 由其他方块触发\r\n      if (this.statusType == 1 && this._game.statusType == 5 && this.color == color) {\r\n        this.playDieAction().then(() => {\r\n          this.onBlockPop(color, null, null)\r\n        })\r\n      }\r\n    }\r\n  },\r\n  onBlockPop(color, isChain, isBomb) {\r\n    let self = this\r\n    isChain = JSON.stringify(isChain) == 'null' ? true : isChain\r\n    isBomb = isBomb ? isBomb : false\r\n    self._game.checkNeedFall()\r\n    self._game.statusType = 5\r\n    self._gameController.musicManager.onPlayAudio(0\r\n    )\r\n    if (this._itemType != 0) {\r\n      // console.log(\"触发了道具\", this._itemType)\r\n\r\n      self._game.onItem(this._itemType, color, {\r\n        x: this.node.x,\r\n        y: this.node.y\r\n      })\r\n    }\r\n    self._game._gameScore.addScore(cc.v2(this.node.x, this.node.y - this.node.width + this._game.gapCfgNum), this._itemType == 3 ? this._game._gameController.config.json.propConfig[2].score : null)\r\n\r\n    // 连锁状态\r\n    if (isChain) {\r\n      if ((self.iid - 1) >= 0) {\r\n        self._game.map[self.iid - 1][self.jid].getComponent('element').onTouched(color)\r\n      }\r\n      if ((self.iid + 1) < this._game.rowCfgNum) {\r\n        self._game.map[self.iid + 1][self.jid].getComponent('element').onTouched(color)\r\n      }\r\n      if ((self.jid - 1) >= 0) {\r\n        self._game.map[self.iid][self.jid - 1].getComponent('element').onTouched(color)\r\n      }\r\n      if ((self.jid + 1) < this._game.rowCfgNum) {\r\n        self._game.map[self.iid][self.jid + 1].getComponent('element').onTouched(color)\r\n      }\r\n    }\r\n  },\r\n  playFallAction(y, data) { //下降了几个格子\r\n    this.statusType = 0\r\n    if (data) {\r\n      this.iid = data.y\r\n      this.jid = data.x\r\n    }\r\n    let action = cc.moveBy(0.25, 0, -y * (this._game.gapCfgNum + this._game.blockClsWidth)).easing(cc.easeBounceOut(5 / y)) //1 * y / this._game.animaCfgSpeed\r\n    let seq = cc.sequence(action, cc.callFunc(() => {\r\n      this.statusType = 1\r\n      //  this._game.checkNeedGenerator()\r\n    }, this))\r\n    this.node.runAction(seq)\r\n  },\r\n  playStartAction() {\r\n    this.node.scaleX = 0\r\n    this.node.scaleY = 0\r\n    let action = cc.scaleTo(0.8 / this._game.animaCfgSpeed, 1, 1).easing(cc.easeBackOut())\r\n    let seq = cc.sequence(action, cc.callFunc(() => {\r\n      this.statusType = 1\r\n    }, this))\r\n    // 如果有延迟时间就用延迟时间\r\n    if (this.startTime) {\r\n      setTimeout(() => {\r\n          this.node.runAction(seq)\r\n        }, this.startTime / 1\r\n        // (cc.game.getFrameRate() / 60)\r\n      )\r\n    } else {\r\n      this.node.runAction(seq)\r\n    }\r\n  },\r\n  playDieAction() {\r\n    let self = this\r\n    clearTimeout(this.surfaceTimer)\r\n    this.node.stopAllActions()\r\n    this.statusType = 2\r\n    this.node.scaleX = 1\r\n    this.node.scaleY = 1\r\n    return new Promise((resolve, reject) => {\r\n      let action\r\n      if (this.warningSprite.spriteFrame) { //有道具预警\r\n        let tween1 = cc.scaleTo(0.2 / self._game.animaCfgSpeed, 1.1)\r\n        let action2 = cc.moveTo(0.2 / self._game.animaCfgSpeed, this._game.target.x, this._game.target.y)\r\n        let action3 = cc.scaleTo(0.2, 0)\r\n        var seq = cc.sequence(tween1, cc.callFunc(() => {\r\n          resolve('')\r\n        }, this), cc.spawn(action2, action3))\r\n      } else {\r\n        action = cc.scaleTo(0.2 / self._game.animaCfgSpeed, 0, 0)\r\n        var seq = cc.sequence(action, cc.callFunc(() => {\r\n          resolve('')\r\n        }, this))\r\n      }\r\n      self.node.runAction(seq)\r\n    });\r\n  },\r\n  surfaceAction(dela) {\r\n    this.surfaceTimer = setTimeout(() => {\r\n      let action = cc.scaleTo(0.4 / this._game.animaCfgSpeed, 0.8, 0.8)\r\n      let tween1 = cc.scaleTo(0.4 / this._game.animaCfgSpeed, 1, 1)\r\n      this.node.runAction(cc.sequence(action, tween1))\r\n    }, dela)\r\n  },\r\n  generatePropAction() {\r\n\r\n  },\r\n  generateItem(type) {\r\n    this._itemType = type\r\n  },\r\n});"]}