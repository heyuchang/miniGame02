{"version":3,"sources":["assets\\Script\\score.js"],"names":["AC","require","cc","Class","Component","properties","scorePrefab","Prefab","scoreParticlePrefab","mainScoreLabel","Label","successDialog","characterMgr","failDialog","Node","multPropPrefab","chainSpriteFrameArr","SpriteFrame","stepAniLabel","tipBox","init","g","_game","_gameController","score","leftStep","config","json","originStep","chain","level","reviveTime","closeMultLabel","levelData","gameData","nameLabel","string","progressBar","leftStepLabel","node","runAction","hide","scoreTimer","currentAddedScore","active","showHeroCharacter","hideChainSprite","social","height","getHighestLevel","onStep","giftStep","start","generatePrefabPool","bindNode","scorePool","NodePool","i","instantiate","put","scoreParticlePool","scoreParticle","multPropPool","multProp","instantiateScore","self","num","pos","size","get","parent","scoreContainer","getComponent","scoreParticleTime","getChildByName","multLabel","chainSprite","Sprite","failScore","failName","failSprite","failHighScore","Promise","resolve","reject","onGameOver","showStepAni","addScore","scoreBase","chainTimer","clearTimeout","initCurrentScoreLabel","setTimeout","onCurrentScoreLabel","x","y","callFunc","multiple","checkLevelUp","checkChain","checkChainTimer","chainConfig","length","max","min","showChainSprite","id","spriteFrame","scale","popOut","levelLimit","onLevelUp","addMult","color","maxMultiple","showMultLabel","callback","action","spawn","moveTo","scaleTo","easing","easeBackOut","seq","sequence","pageManager","addPage","musicManager","onWin","onSuccessDialog","statusType","openBannerAdv","hideNextLevelData","onLevelUpButton","double","console","log","isLevelUp","currentTarget","onOpenPage","step","onLevelUpBtn","name","then","showNextLevelData","toggleVisibility","moveBy","isTrue","gameOver","updateFailPage","askRevive","onDoubleStepBtn","onReviveButton","onDoubleStep","onRevive","nextLevelData","onFail"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * @author heyuchang\r\n * @file  UI 分数控制器\r\n */\r\nvar AC = require('GameAct')\r\n\r\ncc.Class({\r\n  extends: cc.Component,\r\n  properties: {\r\n    scorePrefab: cc.Prefab,\r\n    scoreParticlePrefab: cc.Prefab,\r\n    mainScoreLabel: cc.Label,\r\n    successDialog: require('successDialog'),\r\n    characterMgr: require('character'),\r\n    failDialog: cc.Node,\r\n    multPropPrefab: cc.Prefab,\r\n    // progressBar: require('progress'),\r\n    // leftStepLabel: cc.Label,\r\n    chainSpriteFrameArr: [cc.SpriteFrame],\r\n    stepAniLabel: cc.Label,\r\n\r\n    //提示小框\r\n    tipBox: require('tipBox')\r\n  },\r\n  init(g) {\r\n    this._game = g\r\n    this._gameController = g._gameController\r\n    this.score = 0\r\n    this.leftStep = this._gameController.config.json.originStep\r\n    this.chain = 1\r\n    this.level = 1\r\n    this.reviveTime = 0\r\n    this.closeMultLabel()\r\n    this.levelData = g._gameController.gameData.json.levelData\r\n    this.nameLabel.string = \"萌心悦\"\r\n    this.progressBar.init(0, this.levelData[this.level - 1], this.level)\r\n    this.leftStepLabel.string = this.leftStep\r\n    this.stepAniLabel.node.runAction(cc.hide())\r\n    this.scoreTimer = []\r\n    this.currentAddedScore = 0\r\n    this.mainScoreLabel.node.active = false\r\n    this.characterMgr.showHeroCharacter(this.level)\r\n    this.hideChainSprite()\r\n\r\n    this.tipBox.init(this, 0)\r\n    if (this._gameController.social.node.active) {\r\n      let height = this._gameController.social.getHighestLevel()\r\n      if (height) {\r\n        this.onStep(this.levelData[+height - 1].giftStep)\r\n      }\r\n    }\r\n  },\r\n  start() {\r\n    this.generatePrefabPool()\r\n    this.bindNode()\r\n  },\r\n  generatePrefabPool() {\r\n    this.scorePool = new cc.NodePool()\r\n    for (let i = 0; i < 20; i++) {\r\n      let score = cc.instantiate(this.scorePrefab)\r\n      this.scorePool.put(score)\r\n    }\r\n    this.scoreParticlePool = new cc.NodePool()\r\n    for (let i = 0; i < 20; i++) {\r\n      let scoreParticle = cc.instantiate(this.scoreParticlePrefab)\r\n      this.scoreParticlePool.put(scoreParticle)\r\n    }\r\n    this.multPropPool = new cc.NodePool()\r\n    for (let i = 0; i < 3; i++) {\r\n      let multProp = cc.instantiate(this.multPropPrefab)\r\n      this.multPropPool.put(multProp)\r\n    }\r\n  },\r\n  // 实例化单个方块\r\n  instantiateScore(self, num, pos) {\r\n    let score = null\r\n    if (self.scorePool && self.scorePool.size() > 0) {\r\n      score = self.scorePool.get()\r\n    } else {\r\n      score = cc.instantiate(self.scorePrefab)\r\n    }\r\n    score.parent = this.scoreContainer\r\n    score.getComponent('scoreCell').init(self, num, pos)\r\n\r\n    let scoreParticle = null\r\n    if (self.scoreParticlePool && self.scoreParticlePool.size() > 0) {\r\n      scoreParticle = self.scoreParticlePool.get()\r\n    } else {\r\n      scoreParticle = cc.instantiate(self.scoreParticlePrefab)\r\n    }\r\n    scoreParticle.parent = this.scoreContainer\r\n    scoreParticle.getComponent('scoreParticle').init(self, pos, this._gameController.config.json.scoreParticleTime)\r\n  },\r\n  bindNode() {\r\n    this.leftStepLabel = this.node.getChildByName('UI').getChildByName('leftStepNode').getChildByName('Label').getComponent(cc.Label)\r\n    this.progressBar = this.node.getChildByName('UI').getChildByName('scoreNode').getChildByName('progressBar').getComponent('progress')\r\n    this.scoreContainer = this.node.getChildByName('UI').getChildByName('scoreGroup')\r\n    this.multLabel = this.mainScoreLabel.node.getChildByName('mult').getComponent(cc.Label)\r\n    this.nameLabel = this.node.getChildByName('UI').getChildByName('scoreNode').getChildByName('progressBar').getChildByName('name').getComponent(cc.Label)\r\n    // 失败时更新失败UI\r\n    this.chainSprite = this.node.getChildByName('UI').getChildByName('chainSprite').getComponent(cc.Sprite)\r\n    this.failScore = this.failDialog.getChildByName('info').getChildByName('score').getComponent(cc.Label)\r\n    this.failName = this.failDialog.getChildByName('info').getChildByName('level').getComponent(cc.Label)\r\n    this.failSprite = this.failDialog.getChildByName('info').getChildByName('sprite').getComponent(cc.Sprite)\r\n    this.failHighScore = this.failDialog.getChildByName('info').getChildByName('highScore').getComponent(cc.Label)\r\n  },\r\n  //--------------------- 分数控制 ---------------------\r\n  // 增加 减少步数并且刷新UI\r\n  onStep(num) {\r\n    this.leftStep += num\r\n    return new Promise((resolve, reject) => {\r\n      if (this.leftStep < 0) {\r\n        this.leftStep = 0\r\n        this.onGameOver()\r\n        resolve(false)\r\n      } else {\r\n        resolve(true)\r\n      }\r\n      this.leftStepLabel.string = this.leftStep\r\n      if (num > 0) {\r\n        this.showStepAni(num)\r\n      }\r\n    })\r\n  },\r\n\r\n  //增加分数总控制 获取连击\r\n  addScore(pos, score) {\r\n    score = score || this._gameController.config.json.scoreBase\r\n    // 一次消除可以叠chain\r\n    if (this.chainTimer) {\r\n      clearTimeout(this.chainTimer)\r\n    }\r\n    this.initCurrentScoreLabel()\r\n    this.chainTimer = setTimeout(() => {\r\n        this.onCurrentScoreLabel(this.currentAddedScore, {\r\n          x: -60,\r\n          y: 355\r\n        }, cc.callFunc(() => {\r\n          this.score += this.currentAddedScore * this.multiple\r\n          this.checkLevelUp()\r\n          this.chain = 1\r\n          this.closeMultLabel()\r\n          this.hideChainSprite()\r\n          this.currentAddedScore = 0\r\n          this.mainScoreLabel.node.active = false\r\n        }, this))\r\n      }, 500 / 1\r\n      // (cc.game.getFrameRate() / 60)\r\n    )\r\n    let addScore = score == this._gameController.config.json.scoreBase ? (score + (this.chain > 16 ? 16 : (this.chain - 1)) * 10) : score\r\n    // let addScore = score == 10 ? score * (this.chain > 10 ? 10 : this.chain) : score\r\n    this.currentAddedScore += addScore\r\n    this.mainScoreLabel.string = this.currentAddedScore\r\n    this.instantiateScore(this, addScore, pos)\r\n    this.chain++\r\n    this.checkChain()\r\n  },\r\n  // 判断连击\r\n  checkChain() {\r\n    if (this.checkChainTimer) {\r\n      clearTimeout(this.checkChainTimer)\r\n    }\r\n    this.checkChainTimer = setTimeout(() => {\r\n      let config = this._gameController.config.json.chainConfig\r\n      for (let i = 0; i < config.length; i++) {\r\n        if (this.chain <= config[i].max && this.chain >= config[i].min) {\r\n          //  console.log(config[i].text)\r\n          this.showChainSprite(i)\r\n          return\r\n        }\r\n      }\r\n    }, 200)\r\n  },\r\n  showChainSprite(id) {\r\n    this.chainSprite.spriteFrame = this.chainSpriteFrameArr[id]\r\n    this.chainSprite.node.scale = 0.5\r\n    this.chainSprite.node.active = true\r\n    this.chainSprite.node.runAction(AC.popOut(0.3))\r\n  },\r\n  hideChainSprite() {\r\n    this.chainSprite.node.active = false\r\n  },\r\n  checkLevelUp() {\r\n    if (this.level < this.levelData.length && this.score >= this.levelData[this.level - 1].score) {\r\n      this.level++\r\n      this.level > (this.levelData.length + 1) ? this.levelLimit() : this.onLevelUp()\r\n    }\r\n    this.progressBar.init(this.score, this.levelData[this.level - 1], this.level)\r\n  },\r\n  // 增加倍数\r\n  addMult(color, pos) {\r\n    //TODO: 动态生成一个图片 移动到multLabel上 有bug\r\n    // if (this.multPropPool.size() > 0) {\r\n    //   let multProp = this.multPropPool.get()\r\n    //   multProp.parent = this.mainScoreLabel.node\r\n    //   multProp.x = pos.x\r\n    //   multProp.y = pos.y\r\n    //   multProp.getComponent(cc.Sprite).spriteFrame = this._game.propSpriteFrame[color - 1]\r\n    //   multProp.runAction(cc.sequence(cc.moveTo(0.2, 187, 0), cc.callFunc(() => {\r\n    //     this.multPropPool.put(multProp)\r\n    //   })))\r\n    // }\r\n    if (this.multiple < this._gameController.config.json.maxMultiple) {\r\n      this.multiple *= 2\r\n      this.showMultLabel()\r\n    }\r\n  },\r\n  // 关闭倍数的数字显示\r\n  closeMultLabel() {\r\n    this.multiple = 1\r\n    this.multLabel.node.active = false\r\n  },\r\n  showMultLabel() {\r\n    this.multLabel.node.scale = 0.5\r\n    this.multLabel.string = this.multiple\r\n    this.multLabel.node.active = true\r\n    this.multLabel.node.runAction(AC.popOut(0.3))\r\n  },\r\n  // 增加分数倍数\r\n  initCurrentScoreLabel() {\r\n    this.mainScoreLabel.node.active = true\r\n    this.mainScoreLabel.node.x = 0\r\n    this.mainScoreLabel.node.y = 0\r\n    this.mainScoreLabel.node.scale = 1\r\n  },\r\n  // 生成小的分数节点\r\n  onCurrentScoreLabel(num, pos, callback) {\r\n    // TODO: 增加一个撒花特效\r\n    this.mainScoreLabel.string = num\r\n    let action = cc.spawn(cc.moveTo(0.2, pos.x, pos.y), cc.scaleTo(0.2, 0.4)).easing(cc.easeBackOut())\r\n    let seq = cc.sequence(action, callback)\r\n    this.mainScoreLabel.node.runAction(seq)\r\n  },\r\n  // 升级\r\n  onLevelUp() {\r\n    this._gameController.pageManager.addPage(2)\r\n    this._gameController.pageManager.addPage(3)\r\n    this._gameController.musicManager.onWin()\r\n    this.successDialog.init(this, this.level, this.levelData, this.score) //升级之后的等级\r\n    this.characterMgr.onLevelUp()\r\n    this.characterMgr.onSuccessDialog(this.level)\r\n    this._game.statusType = 2\r\n    if (this._gameController.social.node.active) {\r\n      this._gameController.social.openBannerAdv()\r\n    }\r\n  },\r\n  // 等级限制\r\n  levelLimit() {\r\n    //console.log('等级达到上限')\r\n    this.hideNextLevelData()\r\n  },\r\n  // 点击升级按钮\r\n  onLevelUpButton(double) {\r\n    console.log(double)\r\n    if (this.isLevelUp) {\r\n      return\r\n    } else {\r\n      this.isLevelUp = true\r\n    }\r\n    setTimeout(() => {\r\n      this.isLevelUp = false\r\n    }, 500)\r\n    if (double && double.currentTarget) {\r\n      double = 1\r\n    } else {\r\n      double = double || 1\r\n    }\r\n    this._gameController.pageManager.onOpenPage(1)\r\n    this.initCurrentScoreLabel()\r\n    this.mainScoreLabel.string = this.levelData[this.level - 2].step * double\r\n    this.characterMgr.onLevelUpBtn(this.level)\r\n    this.nameLabel.string = this.levelData[this.level - 1].name\r\n    setTimeout(() => {\r\n      this.onCurrentScoreLabel(this.levelData[this.level - 2].step * double, {\r\n        x: -248,\r\n        y: 350\r\n      }, cc.callFunc(() => {\r\n        // this.tipBox.init(this) 每次升级就咏诗\r\n        this.onStep(this.levelData[this.level - 2].step * double).then()\r\n        this._game.statusType = 1\r\n        this.mainScoreLabel.node.active = false\r\n      }))\r\n    }, 300);\r\n    this.showNextLevelData()\r\n    this.checkLevelUp()\r\n  },\r\n  // todo: 新增一个 动画 数字上浮和缩放\r\n  showStepAni(num) {\r\n    this.stepAniLabel.string = '+' + (num + '')\r\n    this.stepAniLabel.node.x = -248\r\n    this.stepAniLabel.node.y = 400\r\n    this.stepAniLabel.node.runAction(cc.sequence(cc.toggleVisibility(), cc.moveBy(0.6, 0, 60), cc.toggleVisibility()))\r\n    let action = cc.sequence(cc.scaleTo(0.2, 0.8), AC.popOut(0.8))\r\n    this.leftStepLabel.node.parent.runAction(action)\r\n  },\r\n  // 游戏结束\r\n  // todo 复活\r\n  onGameOver(isTrue) {\r\n    isTrue = isTrue || 0\r\n    if (this._game.statusType != 3 && (isTrue || this.reviveTime >= 3)) {\r\n      this._game.gameOver()\r\n      this.updateFailPage()\r\n      if (this._gameController.social.node.active) {\r\n        // 仅上传分数\r\n        this._gameController.social.onGameOver(this.level, this.score)\r\n      }\r\n    } else if (!isTrue) {\r\n      this._game.askRevive()\r\n    }\r\n  },\r\n  onDoubleStepBtn() {\r\n    if (this._gameController.social.node.active) {\r\n      this._gameController.social.onReviveButton(0)\r\n    } else {\r\n      this.onLevelUpButton(2)\r\n    }\r\n  },\r\n  onDoubleStep() {\r\n    this.onLevelUpButton(2)\r\n  },\r\n  onRevive() {\r\n    this.reviveTime += 1\r\n    this.onStep(5).then()\r\n  },\r\n  // 展示下一级的信息\r\n  showNextLevelData() {\r\n    let nextLevelData = this.levelData[this.level]\r\n  },\r\n  // 达到最高级之后 隐藏\r\n  hideNextLevelData() {\r\n\r\n  },\r\n  updateFailPage() {\r\n    this.failScore.string = \" \" + (this.score + '')\r\n    this.characterMgr.onFail(this.level)\r\n    this.failName.string = this.levelData[this.level - 1].name\r\n    //this.failHighScore.string = \"正在获取您的最高分...\"\r\n  },\r\n\r\n});"]}