window.__require=function e(t,n,a){function o(r,c){if(!n[r]){if(!t[r]){var s=r.split("/");if(s=s[s.length-1],!t[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){return o(t[r][1][e]||e)},l,l.exports,e,t,n,a)}return n[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<a.length;r++)o(a[r]);return o}({RankItem:[function(e,t){"use strict";cc._RF.push(t,"55a04/JTDFJ66hoYvR9UyF7","RankItem"),cc.Class({extends:cc.Component,properties:{rankingLabel:cc.Label,avatarSprite:cc.Sprite,nicknameLabel:cc.Label,scoreLabel:cc.Label},set:function(e,t){this.rankingLabel.string=e.toString(),this.nicknameLabel.string=t.nickname,this.scoreLabel.string=t.KVDataList[0].value.toString(),this.updateAvatar(t.avatarUrl)},updateAvatar:function(e){var t=this,n=wx.createImage();n.onload=function(){var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),t.avatarSprite.spriteFrame=new cc.SpriteFrame(e)},n.src=e},start:function(){}}),cc._RF.pop()},{}],Rank:[function(e,t){"use strict";cc._RF.push(t,"5ed60TjCHlAjoL1+F/+Dnbi","Rank");var n,a=(n=e("./RankItem"))&&n.__esModule?n:{default:n};function o(e,t,n,a,o,i,r){try{var c=e[i](r),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(a,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(a,i){var r=e.apply(t,n);function c(e){o(r,a,i,c,s,"next",e)}function s(e){o(r,a,i,c,s,"throw",e)}c(void 0)})}}var r=cc._decorator;r.ccclass,r.property,cc.Class({extends:cc.Component,properties:{content:cc.Node,itemPrefab:cc.Prefab},onLoad:function(){var e=this;cc.sys.platform===cc.sys.WECHAT_GAME_SUB&&wx.onMessage(function(t){return e.onMessage(t)})},start:function(){},onMessage:function(e){switch(e.event){case"setScore":this.setScore(e.score,level);break;case"getRank":this.getRank()}},onReviveButton:function(e,t){var n=this;this.adType=e,this.audioAd?this.audioAd.show().catch(function(){n.audioAd.load().then(function(){return n.audioAd.show()}).catch(function(n){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25",n.errMsg),e?t.game.onSkipRevive():t.scoreMgr.onLevelUpButton()})}):(this.audioAd=wx.createRewardedVideoAd({adUnitId:"adunit-482148cfeb243378"}),this.audioAd.show().catch(function(){n.audioAd.load().then(function(){return n.audioAd.show()}).catch(function(){n.fakeShare(t)})}),this.audioAd.onError(function(){n.fakeShare(t)}),this.audioAd.onClose(function(e){self.adType?e&&e.isEnded||void 0===e?t.game.showReviveSuccess():t.game.askRevive():(e&&e.isEnded||void 0===e)&&t.scoreMgr.onLevelUpButton(2)}))},fakeShare:function(e){wx.shareAppMessage({title:"\u6211\u5df2\u7ecf\u73a9\u5230"+e.scoreMgr.score+"\u5206\u4e86\uff0c\u9080\u8bf7\u4f60\u6765\u6311\u6218",imageUrl:"https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0"}),this.adType?e.game.showReviveSuccess():e.scoreMgr.onLevelUpButton(2)},getScore:function(){return new Promise(function(e){console.log("[getScore]"),wx.getUserCloudStorage({keyList:["score"],success:function(t){console.log("[getScore]","success",t),e(t.KVDataList[0]?parseInt(t.KVDataList[0].value):0)},fail:function(){console.log("[getScore]","fail"),e(-1)}})})},setScore:function(e,t){var n=this;return i(regeneratorRuntime.mark(function a(){var o,i,r,c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:o=t,i=e,o=wx.getStorageSync("highLevel"),o=(o=parseInt(o))?o<t?t:o:t,i=(i=wx.getStorageSync("highScore"))?(i=parseInt(i))<e?e:i:e,r=n._controller.gameData.json.levelData[o-1].name,wx.setStorageSync("highLevel",o+""),wx.setStorageSync("highScore",i+""),(c=new Array).push({key:"highLevel",value:r},{key:"highScore",value:i+""}),wx.setUserCloudStorage({KVDataList:c,success:function(){self.showRank()},fail:function(e){console.log("11111111111111111fail",e)}});case 13:case"end":return a.stop()}},a)}))()},getRank:function(){var e=this;return i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[getRank]"),t.next=3,new Promise(function(t){wx.getFriendCloudStorage({keyList:["highScore"],success:function(n){console.log("[getRank]","success",n),n.data.sort(function(e,t){return 0===e.KVDataList.length&&0===t.KVDataList.length?0:0===e.KVDataList.length?1:0===t.KVDataList.length?-1:parseInt(t.KVDataList[0].value)-parseInt(e.KVDataList[0].value)}),e.updateRankList(n.data),t()},fail:function(){console.log("[getRank]","fail"),t()}})});case 3:case"end":return t.stop()}},t)}))()},updateRankList:function(e){for(var t=Math.max(e.length,this.content.childrenCount),n=0;n<t;n++)if(e[n]&&this.content.children[n])this.content.children[n].active=!0,this.content.children[n].getComponent(a.default).set(n+1,e[n]);else if(e[n]&&!this.content.children[n]){var o=cc.instantiate(this.itemPrefab);o.setParent(this.content),o.getComponent(a.default).set(n+1,e[n])}else this.content.children[n].active=!1},showLoading:function(){this.loading.active=!0},hideLoading:function(){this.loading.active=!1}}),cc._RF.pop()},{"./RankItem":"RankItem"}]},{},["Rank","RankItem"]);